<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="http://www.suelibrary.store/">
    <title>Charlotte's Web ÌïôÏäµ - ÏàòÎ¶¨Îî©Ïñ¥ÌïôÏõê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .learning-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .book-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .book-cover {
            width: 80px;
            height: 120px;
            border-radius: 10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .book-info {
            flex: 1;
        }

        .book-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .book-author {
            font-size: 1.2rem;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .book-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #666;
        }

        .meta-item {
            background: #f8f9fa;
            padding: 5px 12px;
            border-radius: 15px;
        }

        .audio-control {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .audio-control:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 25px;
            flex: 1;
        }

        .chapter-sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            height: fit-content;
            max-height: 80vh;
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .chapter-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .chapter-item {
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            border: 2px solid transparent;
            position: relative;
        }

        .chapter-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .chapter-item.active {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .chapter-item.has-audio::after {
            content: 'üéµ';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
        }

        .question-area {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            flex: 1;
        }

        .chapter-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .chapter-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .chapter-progress {
            font-size: 1rem;
            color: #666;
            margin-bottom: 20px;
        }

        .audio-player {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .audio-status {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
            padding: 8px 15px;
            background: #e9ecef;
            border-radius: 10px;
            display: inline-block;
        }

        .audio-status.loading {
            color: #007bff;
        }

        .audio-status.ready {
            color: #28a745;
        }

        .audio-status.error {
            color: #dc3545;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .audio-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .audio-btn:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .audio-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .audio-progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
            cursor: pointer;
        }

        .audio-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .audio-time {
            font-size: 0.9rem;
            color: #666;
        }

        .question-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 2px solid #f8f9fa;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .question-type {
            background: #f8f9fa;
            color: #666;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .question-text {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(3px);
        }

        .option.selected {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .option.correct {
            background: linear-gradient(135deg, #28a74515, #20c99715);
            border-color: #28a745;
        }

        .option.incorrect {
            background: linear-gradient(135deg, #dc354515, #c8233315);
            border-color: #dc3545;
        }

        .option-letter {
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: #764ba2;
        }

        .option.correct .option-letter {
            background: #28a745;
        }

        .option.incorrect .option-letter {
            background: #dc3545;
        }

        .option-text {
            flex: 1;
            font-size: 1rem;
            line-height: 1.4;
        }

        .question-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prev-btn {
            background: #6c757d;
            color: white;
        }

        .next-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .check-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .result-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
        }

        .result-feedback.correct {
            background: linear-gradient(135deg, #28a74515, #20c99715);
            border: 1px solid #28a745;
            color: #155724;
        }

        .result-feedback.incorrect {
            background: linear-gradient(135deg, #dc354515, #c8233315);
            border: 1px solid #dc3545;
            color: #721c24;
        }

        .chapter-summary {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        .summary-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .summary-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .chapter-sidebar {
                order: 2;
            }
            
            .question-area {
                order: 1;
            }
            
            .book-header {
                flex-direction: column;
                text-align: center;
            }
            
            .audio-controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="learning-container">
        <!-- Ï±Ö Ìó§Îçî -->
        <div class="book-header">
            <div class="book-cover">
                Charlotte's<br>Web
            </div>
            <div class="book-info">
                <div class="book-title">Charlotte's Web</div>
                <div class="book-author">by E.B. White</div>
                <div class="book-meta">
                    <div class="meta-item">Level 3</div>
                    <div class="meta-item">Ï§ëÍ∏â</div>
                    <div class="meta-item">45Î∂Ñ</div>
                    <div class="meta-item">22 Chapters</div>
                </div>
            </div>
            <button class="audio-control" onclick="toggleMainAudio()">
                <span id="main-audio-icon">üéµ</span>
                Ï†ÑÏ≤¥ Îì£Í∏∞
            </button>
        </div>

        <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
        <div class="main-content">
            <!-- Ï±ïÌÑ∞ ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <div class="chapter-sidebar">
                <div class="sidebar-title">üìö Chapters</div>
                <div class="chapter-list" id="chapter-list">
                    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
                </div>
            </div>

            <!-- Î¨∏Ï†ú ÏòÅÏó≠ -->
            <div class="question-area">
                <div class="chapter-header">
                    <div class="chapter-title" id="chapter-title">Chapter 1: Before Breakfast</div>
                    <div class="chapter-progress" id="chapter-progress">Î¨∏Ï†ú 1/12</div>
                </div>

                <!-- Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ -->
                <div class="audio-player">
                    <div class="audio-status" id="audio-status">Ïò§ÎîîÏò§ Ï§ÄÎπÑ Ï§ë...</div>
                    <div class="audio-controls">
                        <button class="audio-btn" onclick="seekAudio(-10)" id="seek-back-btn" disabled>‚è™</button>
                        <button class="audio-btn" onclick="toggleAudio()" id="play-btn" disabled>‚ñ∂Ô∏è</button>
                        <button class="audio-btn" onclick="seekAudio(10)" id="seek-forward-btn" disabled>‚è©</button>
                    </div>
                    <div class="audio-progress" onclick="setProgress(event)">
                        <div class="audio-progress-bar" id="audio-progress-bar"></div>
                    </div>
                    <div class="audio-time">
                        <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                    </div>
                </div>

                <!-- Î¨∏Ï†ú Ïπ¥Îìú -->
                <div class="question-card">
                    <div class="question-header">
                        <div class="question-number" id="question-number">Question 1</div>
                        <div class="question-type">Multiple Choice</div>
                    </div>

                    <div class="question-text" id="question-text">
                        Î¨∏Ï†úÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...
                    </div>

                    <div class="options-container" id="options-container">
                        <!-- ÏÑ†ÌÉùÏßÄÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
                    </div>

                    <div class="result-feedback" id="result-feedback" style="display: none;">
                        <!-- Í≤∞Í≥º ÌîºÎìúÎ∞± -->
                    </div>

                    <div class="question-controls">
                        <button class="control-btn prev-btn" id="prev-btn" onclick="previousQuestion()" disabled>
                            ‚¨ÖÔ∏è Ïù¥Ï†Ñ
                        </button>
                        
                        <button class="control-btn check-btn" id="check-btn" onclick="checkAnswer()">
                            Ï†ïÎãµ ÌôïÏù∏
                        </button>

                        <button class="control-btn next-btn" id="next-btn" onclick="nextQuestion()" disabled>
                            Îã§Ïùå ‚û°Ô∏è
                        </button>
                    </div>
                </div>

                <!-- Ï±ïÌÑ∞ ÏöîÏïΩ (ÏôÑÎ£å Ïãú ÌëúÏãú) -->
                <div class="chapter-summary" id="chapter-summary" style="display: none;">
                    <div class="summary-title">üéâ Chapter 1 ÏôÑÎ£å!</div>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="stat-value" id="correct-count">0</div>
                            <div class="stat-label">Ï†ïÎãµ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="total-count">12</div>
                            <div class="stat-label">Ï¥ù Î¨∏Ï†ú</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="accuracy">0%</div>
                            <div class="stat-label">Ï†ïÌôïÎèÑ</div>
                        </div>
                    </div>
                    <button class="control-btn next-btn" onclick="nextChapter()">
                        Îã§Ïùå Ï±ïÌÑ∞Î°ú ‚û°Ô∏è
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïã§Ï†ú Ïò§ÎîîÏò§ ÏóòÎ¶¨Î®ºÌä∏ -->
    <audio id="book-audio" preload="metadata">
        <!-- ÏÜåÏä§Îäî ÎèôÏ†ÅÏúºÎ°ú ÏÑ§Ï†ïÎê©ÎãàÎã§ -->
    </audio>

    <script>
        // Í∞ÑÏÜåÌôîÎêú Ïò§ÎîîÏò§ ÌååÏùº Îß§Ìïë
        const audioMapping = {
            1: { patterns: ['ch01.mp3'] },
            2: { patterns: ['ch02.mp3'] },
            3: { patterns: ['ch03.mp3'] },
            4: { patterns: ['ch04.mp3'] },
            5: { patterns: ['ch05.mp3'] },
            6: { patterns: ['ch06.mp3'] },
            7: { patterns: ['ch07.mp3'] },
            8: { patterns: ['ch08.mp3'] },
            9: { patterns: ['ch09.mp3'] },
            10: { patterns: ['ch10.mp3'] },
            11: { patterns: ['ch11.mp3'] },
            12: { patterns: ['ch12.mp3'] },
            13: { patterns: ['ch13.mp3'] },
            14: { patterns: ['ch14.mp3'] },
            15: { patterns: ['ch15.mp3'] },
            16: { patterns: ['ch16.mp3'] },
            17: { patterns: ['ch17.mp3'] },
            18: { patterns: ['ch18.mp3'] },
            19: { patterns: ['ch19.mp3'] },
            20: { patterns: ['ch20.mp3'] },
            21: { patterns: ['ch21.mp3'] },
            22: { patterns: ['ch22.mp3'] }
        };

        // Ï±Ö Îç∞Ïù¥ÌÑ∞
        const bookData = {
            title: "Charlotte's Web",
            author: "E.B. White",
            level: 3,
            audio_base_path: "static/audio/", // base ÌÉúÍ∑∏ ÎçïÎ∂ÑÏóê Í∞ÑÎã®Ìïú Í≤ΩÎ°ú ÏÇ¨Ïö© Í∞ÄÎä•
            chapters: [
                { id: 1, title: "Before Breakfast", duration: "3:45" },
                { id: 2, title: "Wilbur", duration: "4:20" },
                { id: 3, title: "Escape", duration: "3:30" },
                { id: 4, title: "Loneliness", duration: "4:10" },
                { id: 5, title: "Charlotte", duration: "5:15" },
                { id: 6, title: "Summer Days", duration: "4:45" },
                { id: 7, title: "Bad News", duration: "3:20" },
                { id: 8, title: "A Talk at Home", duration: "4:30" },
                { id: 9, title: "Wilbur's Boast", duration: "3:15" },
                { id: 10, title: "An Explosion", duration: "4:05" },
                { id: 11, title: "The Miracle", duration: "5:30" },
                { id: 12, title: "A Meeting", duration: "4:15" },
                { id: 13, title: "Good Progress", duration: "3:50" },
                { id: 14, title: "Dr. Dorian", duration: "4:40" },
                { id: 15, title: "The Crickets", duration: "3:25" },
                { id: 16, title: "Off to the Fair", duration: "4:55" },
                { id: 17, title: "Uncle", duration: "3:35" },
                { id: 18, title: "The Cool of the Evening", duration: "5:10" },
                { id: 19, title: "The Egg Sac", duration: "4:25" },
                { id: 20, title: "The Hour of Triumph", duration: "5:45" },
                { id: 21, title: "Last Day", duration: "4:00" },
                { id: 22, title: "A Warm Wind", duration: "6:20" }
            ]
        };

        // Î¨∏Ï†ú Îç∞Ïù¥ÌÑ∞
        const questionsData = {
            1: [
                { id: 1, question: "Where does Fern live?", options: ["In the city", "On a farm", "In an apartment", "By the ocean"], correct: 1 },
                { id: 2, question: "What does Fern's father plan to do with the small pig?", options: ["Sell it", "Keep it as a pet", "Kill it", "Give it away"], correct: 2 },
                { id: 3, question: "Why does Fern's father want to kill the pig?", options: ["It's sick", "It's too small", "It's aggressive", "It's ugly"], correct: 1 },
                { id: 4, question: "How does Fern feel about her father's plan?", options: ["Happy", "Indifferent", "Very upset", "Confused"], correct: 2 },
                { id: 5, question: "What argument does Fern use to save the pig?", options: ["It's unfair", "She'll take care of it", "It might grow", "It's too young"], correct: 0 },
                { id: 6, question: "What does Fern name the pig?", options: ["Piggy", "Wilbur", "Charlotte", "Babe"], correct: 1 },
                { id: 7, question: "How does Fern take care of Wilbur?", options: ["Feeds him milk", "Gives him baths", "Plays with him", "All of the above"], correct: 3 },
                { id: 8, question: "What time of day does the story begin?", options: ["Morning", "Afternoon", "Evening", "Night"], correct: 0 },
                { id: 9, question: "What season is it in the story?", options: ["Spring", "Summer", "Fall", "Winter"], correct: 0 },
                { id: 10, question: "How old is Fern?", options: ["6 years old", "8 years old", "10 years old", "12 years old"], correct: 1 },
                { id: 11, question: "What kind of animal is Wilbur?", options: ["A sheep", "A pig", "A goat", "A cow"], correct: 1 },
                { id: 12, question: "Who saves the pig's life?", options: ["Mother", "Father", "Fern", "Uncle"], correct: 2 }
            ],
            2: [
                { id: 1, question: "How old is Wilbur when he goes to live with Uncle Homer?", options: ["2 weeks", "4 weeks", "6 weeks", "8 weeks"], correct: 2 },
                { id: 2, question: "Where does Uncle Homer live?", options: ["Next door", "Across the road", "In town", "Far away"], correct: 1 },
                { id: 3, question: "How much does Uncle Homer pay for Wilbur?", options: ["$4", "$5", "$6", "$7"], correct: 2 },
                { id: 4, question: "How does Fern feel about selling Wilbur?", options: ["Happy", "Excited", "Sad", "Angry"], correct: 2 },
                { id: 5, question: "What does Wilbur eat at Uncle Homer's?", options: ["Corn", "Slop", "Grass", "Apples"], correct: 1 },
                { id: 6, question: "Where does Wilbur sleep?", options: ["In the house", "In the barn", "Outside", "In the field"], correct: 1 },
                { id: 7, question: "Who takes care of Wilbur at Uncle Homer's?", options: ["Uncle Homer", "Aunt Edith", "Lurvy", "Fern"], correct: 2 },
                { id: 8, question: "How often does Fern visit Wilbur?", options: ["Every day", "Every week", "Once a month", "Never"], correct: 0 },
                { id: 9, question: "What does Wilbur do most of the day?", options: ["Sleep", "Eat", "Play", "All of the above"], correct: 3 },
                { id: 10, question: "How does Wilbur feel about his new home at first?", options: ["Happy", "Scared", "Lonely", "Excited"], correct: 0 },
                { id: 11, question: "What time does Lurvy feed Wilbur?", options: ["Morning", "Noon", "Evening", "All day"], correct: 3 },
                { id: 12, question: "What kind of building is Wilbur's home?", options: ["Barn", "Shed", "House", "Pen"], correct: 0 }
            ]
        };

        // Î™®Îì† Ï±ïÌÑ∞Ïóê ÎåÄÌï¥ Í∏∞Î≥∏ Î¨∏Ï†ú ÏÉùÏÑ± (3-22Ï±ïÌÑ∞)
        for (let i = 3; i <= 22; i++) {
            questionsData[i] = [
                { id: 1, question: `What happens in Chapter ${i}?`, options: ["Important events", "Character development", "Plot progression", "All of the above"], correct: 3 },
                { id: 2, question: `Who is the main character in this chapter?`, options: ["Wilbur", "Charlotte", "Fern", "Various characters"], correct: 3 },
                { id: 3, question: `What is the mood of Chapter ${i}?`, options: ["Happy", "Sad", "Exciting", "Varies"], correct: 3 },
                { id: 4, question: `What lesson is taught in this chapter?`, options: ["Friendship", "Courage", "Growing up", "Life lessons"], correct: 3 },
                { id: 5, question: `How does this chapter advance the story?`, options: ["New conflicts", "Character growth", "Plot development", "All of the above"], correct: 3 },
                { id: 6, question: `What emotions are explored?`, options: ["Joy", "Fear", "Love", "All emotions"], correct: 3 },
                { id: 7, question: `What is the setting of this chapter?`, options: ["The barn", "The farm", "Various places", "Depends on story"], correct: 3 },
                { id: 8, question: `How do characters interact?`, options: ["Positively", "With conflict", "With understanding", "Various ways"], correct: 3 },
                { id: 9, question: `What themes are present?`, options: ["Friendship", "Life and death", "Growing up", "Multiple themes"], correct: 3 },
                { id: 10, question: `How does this chapter make you feel?`, options: ["Happy", "Thoughtful", "Emotional", "Various feelings"], correct: 3 },
                { id: 11, question: `What is important about this chapter?`, options: ["Character development", "Plot advancement", "Theme exploration", "All aspects"], correct: 3 },
                { id: 12, question: `How does it connect to the whole story?`, options: ["Builds plot", "Develops characters", "Explores themes", "All connections"], correct: 3 }
            ];
        }

        // ÏÉÅÌÉú Î≥ÄÏàò
        let currentChapter = 1;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let isQuestionAnswered = false;
        let chapterScores = {};

        // Ïò§ÎîîÏò§ Í¥ÄÎ†®
        let audioElement = document.getElementById('book-audio');
        let isPlaying = false;
        let availableAudioFiles = {}; // ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Ïò§ÎîîÏò§ ÌååÏùºÎì§
        let currentAudioFile = null;

        // Ï¥àÍ∏∞Ìôî
        function init() {
            generateChapterList();
            checkAudioAvailability();
            loadChapter(1);
            initAudio();
        }

        // Ïò§ÎîîÏò§ ÌååÏùº Í∞ÄÏö©ÏÑ± Ï≤¥ÌÅ¨
        async function checkAudioAvailability() {
            const statusElement = document.getElementById('audio-status');
            statusElement.textContent = 'Ïò§ÎîîÏò§ ÌååÏùº ÌôïÏù∏ Ï§ë...';
            statusElement.className = 'audio-status loading';

            for (const [chapterId, mapping] of Object.entries(audioMapping)) {
                for (const pattern of mapping.patterns) {
                    // Ï†ïÌôïÌïú URL Ïù∏ÏΩîÎî© Ï†ÅÏö©
                    const audioPath = bookData.audio_base_path + encodeURIComponent(pattern).replace(/%20/g, '%20');
                    
                    try {
                        const response = await fetch(audioPath, { method: 'HEAD' });
                        if (response.ok) {
                            availableAudioFiles[chapterId] = audioPath;
                            console.log(`Found audio for chapter ${chapterId}: ${audioPath}`);
                            break; // Ï≤´ Î≤àÏß∏Î°ú Ï∞æÏùÄ ÌååÏùº ÏÇ¨Ïö©
                        } else {
                            console.log(`Failed to load: ${audioPath} (Status: ${response.status})`);
                        }
                    } catch (error) {
                        console.log(`Error loading: ${audioPath}`, error);
                        continue;
                    }
                }
            }

            console.log('Available audio files:', availableAudioFiles);
            updateAudioStatus();
        }

        // Ïò§ÎîîÏò§ ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateAudioStatus() {
            const statusElement = document.getElementById('audio-status');
            const playBtn = document.getElementById('play-btn');
            const seekBackBtn = document.getElementById('seek-back-btn');
            const seekForwardBtn = document.getElementById('seek-forward-btn');

            if (availableAudioFiles[currentChapter]) {
                statusElement.textContent = `Chapter ${currentChapter} Ïò§ÎîîÏò§ Ï§ÄÎπÑÏôÑÎ£å`;
                statusElement.className = 'audio-status ready';
                playBtn.disabled = false;
                seekBackBtn.disabled = false;
                seekForwardBtn.disabled = false;
            } else {
                statusElement.textContent = `Chapter ${currentChapter} Ïò§ÎîîÏò§ ÏóÜÏùå`;
                statusElement.className = 'audio-status error';
                playBtn.disabled = true;
                seekBackBtn.disabled = true;
                seekForwardBtn.disabled = true;
            }
        }

        // Ï±ïÌÑ∞ Î¶¨Ïä§Ìä∏ ÏÉùÏÑ±
        function generateChapterList() {
            const chapterList = document.getElementById('chapter-list');
            chapterList.innerHTML = '';
            bookData.chapters.forEach(chapter => {
                const chapterItem = document.createElement('div');
                chapterItem.className = 'chapter-item';
                chapterItem.onclick = () => loadChapter(chapter.id);
                
                // Ïò§ÎîîÏò§ ÌååÏùºÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏ÌïòÏó¨ ÌëúÏãú
                const hasAudio = audioMapping[chapter.id] && audioMapping[chapter.id].patterns.length > 0;
                if (hasAudio) {
                    chapterItem.classList.add('has-audio');
                }

                chapterItem.innerHTML = `
                    <div style="font-weight: 600;">Chapter ${chapter.id}</div>
                    <div style="font-size: 0.8rem; color: #666;">${chapter.title}</div>
                    <div style="font-size: 0.7rem; color: #999;">${chapter.duration}</div>
                `;
                
                if (chapter.id === currentChapter) {
                    chapterItem.classList.add('active');
                }
                chapterList.appendChild(chapterItem);
            });
        }

        // Ï±ïÌÑ∞ Î°úÎìú
        function loadChapter(chapterId) {
            currentChapter = chapterId;
            currentQuestionIndex = 0;
            userAnswers = [];
            isQuestionAnswered = false;

            // Ïò§ÎîîÏò§ Ï†ïÏßÄ
            if (isPlaying) {
                toggleAudio();
            }

            // Ï±ïÌÑ∞ Î¶¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.chapter-item').forEach((item, index) => {
                item.classList.toggle('active', index + 1 === chapterId);
            });

            // Ï±ïÌÑ∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            const chapter = bookData.chapters.find(c => c.id === chapterId);
            document.getElementById('chapter-title').textContent = `Chapter ${chapterId}: ${chapter.title}`;
            
            // Ï±ïÌÑ∞ ÏöîÏïΩ Ïà®Í∏∞Í∏∞
            document.getElementById('chapter-summary').style.display = 'none';
            
            // Î¨∏Ï†ú Ïπ¥Îìú Î≥¥Ïù¥Í∏∞
            document.querySelector('.question-card').style.display = 'block';
            
            // Ïò§ÎîîÏò§ ÏóÖÎç∞Ïù¥Ìä∏
            loadChapterAudio(chapterId);
            updateAudioStatus();
            
            // Ï≤´ Î≤àÏß∏ Î¨∏Ï†ú Î°úÎìú
            loadQuestion(0);
        }

        // Ï±ïÌÑ∞ Ïò§ÎîîÏò§ Î°úÎìú
        function loadChapterAudio(chapterId) {
            currentAudioFile = availableAudioFiles[chapterId];
            
            if (currentAudioFile) {
                audioElement.src = currentAudioFile;
                audioElement.load();
                console.log(`Loaded audio for chapter ${chapterId}: ${currentAudioFile}`);
            } else {
                audioElement.src = '';
                console.log(`No audio available for chapter ${chapterId}`);
            }
        }

        // Î¨∏Ï†ú Î°úÎìú
        function loadQuestion(questionIndex) {
            currentQuestionIndex = questionIndex;
            isQuestionAnswered = false;

            const questions = questionsData[currentChapter];
            if (!questions || !questions[questionIndex]) {
                console.error('Question not found:', currentChapter, questionIndex);
                return;
            }
            
            const question = questions[questionIndex];

            // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('chapter-progress').textContent = `Î¨∏Ï†ú ${questionIndex + 1}/${questions.length}`;
            document.getElementById('question-number').textContent = `Question ${questionIndex + 1}`;
            document.getElementById('question-text').textContent = question.question;

            // ÏÑ†ÌÉùÏßÄ ÏÉùÏÑ±
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = () => selectOption(index);
                optionDiv.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                optionsContainer.appendChild(optionDiv);
            });

            // Ïª®Ìä∏Î°§ ÏóÖÎç∞Ïù¥Ìä∏
            updateControls();
            
            // ÌîºÎìúÎ∞± Ïà®Í∏∞Í∏∞
            document.getElementById('result-feedback').style.display = 'none';
        }

        // ÏÑ†ÌÉùÏßÄ ÏÑ†ÌÉù
        function selectOption(optionIndex) {
            if (isQuestionAnswered) return;

            // Î™®Îì† ÏÑ†ÌÉùÏßÄÏóêÏÑú selected ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            
            // ÏÑ†ÌÉùÎêú ÏòµÏÖòÏóê selected ÌÅ¥ÎûòÏä§ Ï∂îÍ∞Ä
            document.querySelectorAll('.option')[optionIndex].classList.add('selected');
            
            // ÎãµÎ≥Ä Ï†ÄÏû•
            userAnswers[currentQuestionIndex] = optionIndex;
            
            // Ï≤¥ÌÅ¨ Î≤ÑÌäº ÌôúÏÑ±Ìôî
            document.getElementById('check-btn').disabled = false;
        }

        // Ï†ïÎãµ ÌôïÏù∏
        function checkAnswer() {
            if (isQuestionAnswered) return;

            const questions = questionsData[currentChapter];
            const question = questions[currentQuestionIndex];
            const userAnswer = userAnswers[currentQuestionIndex];
            const correctAnswer = question.correct;

            isQuestionAnswered = true;

            // Î™®Îì† ÏòµÏÖòÏóê Í≤∞Í≥º ÌëúÏãú
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === correctAnswer) {
                    option.classList.add('correct');
                } else if (index === userAnswer && index !== correctAnswer) {
                    option.classList.add('incorrect');
                }
                option.onclick = null; // ÌÅ¥Î¶≠ ÎπÑÌôúÏÑ±Ìôî
            });

            // ÌîºÎìúÎ∞± ÌëúÏãú
            const feedback = document.getElementById('result-feedback');
            feedback.style.display = 'block';
            
            if (userAnswer === correctAnswer) {
                feedback.className = 'result-feedback correct';
                feedback.innerHTML = 'üéâ Ï†ïÎãµÏûÖÎãàÎã§! ÌõåÎ•≠Ìï¥Ïöî!';
            } else {
                feedback.className = 'result-feedback incorrect';
                feedback.innerHTML = `‚ùå ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµÏùÄ "${question.options[correctAnswer]}" ÏûÖÎãàÎã§.`;
            }

            // Ïª®Ìä∏Î°§ ÏóÖÎç∞Ïù¥Ìä∏
            updateControls();
        }

        // Ïª®Ìä∏Î°§ ÏóÖÎç∞Ïù¥Ìä∏
        function updateControls() {
            const questions = questionsData[currentChapter];
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const checkBtn = document.getElementById('check-btn');

            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === questions.length - 1) {
                nextBtn.textContent = 'Ï±ïÌÑ∞ ÏôÑÎ£å üéâ';
                nextBtn.onclick = finishChapter;
            } else {
                nextBtn.textContent = 'Îã§Ïùå ‚û°Ô∏è';
                nextBtn.onclick = nextQuestion;
            }

            if (isQuestionAnswered) {
                checkBtn.style.display = 'none';
                nextBtn.disabled = false;
            } else {
                checkBtn.style.display = 'inline-block';
                checkBtn.disabled = userAnswers[currentQuestionIndex] === undefined;
                nextBtn.disabled = true;
            }
        }

        // Ïù¥Ï†Ñ Î¨∏Ï†ú
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                loadQuestion(currentQuestionIndex - 1);
            }
        }

        // Îã§Ïùå Î¨∏Ï†ú
        function nextQuestion() {
            const questions = questionsData[currentChapter];
            if (currentQuestionIndex < questions.length - 1) {
                loadQuestion(currentQuestionIndex + 1);
            }
        }

        // Ï±ïÌÑ∞ ÏôÑÎ£å
        function finishChapter() {
            const questions = questionsData[currentChapter];
            let correctCount = 0;

            // Ï†êÏàò Í≥ÑÏÇ∞
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    correctCount++;
                }
            });

            chapterScores[currentChapter] = {
                correct: correctCount,
                total: questions.length,
                percentage: Math.round((correctCount / questions.length) * 100)
            };

            // Ï±ïÌÑ∞ ÏöîÏïΩ ÌëúÏãú
            const summary = document.getElementById('chapter-summary');
            const summaryTitle = summary.querySelector('.summary-title');
            summaryTitle.textContent = `üéâ Chapter ${currentChapter} ÏôÑÎ£å!`;
            summary.style.display = 'block';
            
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('total-count').textContent = questions.length;
            document.getElementById('accuracy').textContent = `${chapterScores[currentChapter].percentage}%`;

            // Î¨∏Ï†ú Ïπ¥Îìú Ïà®Í∏∞Í∏∞
            document.querySelector('.question-card').style.display = 'none';
        }

        // Îã§Ïùå Ï±ïÌÑ∞
        function nextChapter() {
            if (currentChapter < bookData.chapters.length) {
                document.querySelector('.question-card').style.display = 'block';
                loadChapter(currentChapter + 1);
            } else {
                // Î™®Îì† Ï±ïÌÑ∞ ÏôÑÎ£å Ïãú Ï†ÑÏ≤¥ Í≤∞Í≥º ÌëúÏãú
                showFinalResults();
            }
        }

        // Ï†ÑÏ≤¥ Í≤∞Í≥º ÌëúÏãú
        function showFinalResults() {
            const totalQuestions = Object.keys(chapterScores).length * 12;
            let totalCorrect = 0;
            
            // Ï†ÑÏ≤¥ Ï†êÏàò Í≥ÑÏÇ∞
            Object.values(chapterScores).forEach(score => {
                totalCorrect += score.correct;
            });
            
            const finalPercentage = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
            
            // Í≤∞Í≥º ÌéòÏù¥ÏßÄ ÌëúÏãú
            document.querySelector('.question-area').innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <h1 style="color: #667eea; margin-bottom: 20px;">üéâ Charlotte's Web ÏôÑÎèÖ Ï∂ïÌïòÌï©ÎãàÎã§! üéâ</h1>
                    <div style="background: linear-gradient(135deg, #667eea15, #764ba215); padding: 30px; border-radius: 20px; margin: 20px 0;">
                        <div style="font-size: 3rem; font-weight: bold; color: #667eea; margin-bottom: 10px;">${finalPercentage}%</div>
                        <div style="font-size: 1.2rem; color: #666; margin-bottom: 20px;">Ï†ÑÏ≤¥ Ï†ïÎãµÎ•†</div>
                        <div style="font-size: 1rem; color: #888;">${totalCorrect}/${totalQuestions} Î¨∏Ï†ú Ï†ïÎãµ</div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button onclick="location.reload()" style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
                            Îã§Ïãú ÌïôÏäµÌïòÍ∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        // Ïò§ÎîîÏò§ Ï¥àÍ∏∞Ìôî
        function initAudio() {
            audioElement.addEventListener('loadedmetadata', () => {
                document.getElementById('total-time').textContent = formatTime(audioElement.duration);
            });

            audioElement.addEventListener('timeupdate', () => {
                if (audioElement.duration) {
                    const progress = (audioElement.currentTime / audioElement.duration) * 100;
                    document.getElementById('audio-progress-bar').style.width = progress + '%';
                    document.getElementById('current-time').textContent = formatTime(audioElement.currentTime);
                }
            });

            audioElement.addEventListener('ended', () => {
                isPlaying = false;
                document.getElementById('play-btn').textContent = '‚ñ∂Ô∏è';
            });

            audioElement.addEventListener('error', (e) => {
                console.error('Audio error:', e);
                const statusElement = document.getElementById('audio-status');
                statusElement.textContent = 'Ïò§ÎîîÏò§ Î°úÎìú Ïã§Ìå®';
                statusElement.className = 'audio-status error';
            });

            // Í∏∞Î≥∏ ÏãúÍ∞Ñ ÏÑ§Ï†ï
            document.getElementById('total-time').textContent = '0:00';
            document.getElementById('current-time').textContent = '0:00';
        }

        // Ïò§ÎîîÏò§ ÌÜ†Í∏Ä
        function toggleAudio() {
            if (!currentAudioFile) {
                console.log('No audio file available for current chapter');
                return;
            }

            if (isPlaying) {
                audioElement.pause();
                document.getElementById('play-btn').textContent = '‚ñ∂Ô∏è';
                isPlaying = false;
            } else {
                const playPromise = audioElement.play();
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            document.getElementById('play-btn').textContent = '‚è∏Ô∏è';
                            isPlaying = true;
                        })
                        .catch(error => {
                            console.error('Audio play failed:', error);
                            const statusElement = document.getElementById('audio-status');
                            statusElement.textContent = 'Ïò§ÎîîÏò§ Ïû¨ÏÉù Ïã§Ìå®';
                            statusElement.className = 'audio-status error';
                        });
                }
            }
        }

        // Î©îÏù∏ Ïò§ÎîîÏò§ ÌÜ†Í∏Ä
        function toggleMainAudio() {
            toggleAudio();
        }

        // Ïò§ÎîîÏò§ ÌÉêÏÉâ
        function seekAudio(seconds) {
            if (audioElement.currentTime !== undefined && currentAudioFile) {
                audioElement.currentTime = Math.max(0, Math.min(audioElement.duration, audioElement.currentTime + seconds));
            }
        }

        // ÏßÑÌñâÎ∞î ÌÅ¥Î¶≠ÏúºÎ°ú ÏúÑÏπò ÏÑ§Ï†ï
        function setProgress(event) {
            if (!currentAudioFile || !audioElement.duration) return;

            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            audioElement.currentTime = percent * audioElement.duration;
        }

        // ÏãúÍ∞Ñ Ìè¨Îß∑
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', init);
    </script>
</body>
</html>
